# alarms (booleans)

- name: kubelet_healthstate
  expr: sum by (node) (mcd_kubelet_state) > bool 2
  desc: Returns 1 if 2 or more failures occur
  type: boolean_per_node
  label: yellow

- name: kubelet_healthstate_critical
  expr: sum by (node) (mcd_kubelet_state) > bool 5
  desc: Returns 1 if 5 or more failures occur
  type: boolean_per_node
  label: red

- name: kubelet_healthstate_critical_fatal
  expr: sum by (node) (mcd_kubelet_state) > bool 10
  desc: Returns 1 if 10 or more failures occur
  type: boolean_per_node
  label: red_fatal

- name: mem_used_gt_mem_reserved_95p
  desc: Return 1 if system exceeds reservations
  expr: |
    (
        sum by (node) (container_memory_rss{id="/system.slice"}) 
    ) - ((
        sum by (node) (kube_node_status_capacity{resource="memory"} - kube_node_status_allocatable{resource="memory"})
    ) * 0.95) > bool 0
  type: boolean_per_node
  label: red

- name: mem_utilization_high
  desc: Return 1 if node mem utilization above 60%
  expr: |
    1 - ((sum(kube_node_status_capacity{resource="memory"}) by (node) 
    - sum(kube_pod_container_resource_requests{resource="memory"}) by (node)) 
    /  sum(kube_node_status_capacity{resource="memory"}) by (node)) > bool 0.60
  type: boolean_per_node
  label: yellow
